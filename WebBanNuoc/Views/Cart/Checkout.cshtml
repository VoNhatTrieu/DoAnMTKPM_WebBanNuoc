@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">
    <div class="row">
        <div class="col-12 mb-4">
            <h2 class="fw-bold">


                
                <link rel="stylesheet" href="/Content/checkout-custom.css" />

                <div class="checkout-container">
                    <!-- LEFT -->
                    <div>
                        <h2 class="page-title">🧾 Thanh toán an toàn</h2>
                        <!-- Thông tin giao hàng -->
                        <div class="card">
                            <h3>🚚 Thông tin giao hàng</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Họ và tên *</label>
                                    <input type="text" id="fullName" placeholder="Nguyễn Văn A">
                                </div>
                                <div class="form-group">
                                    <label>Số điện thoại *</label>
                                    <input type="text" id="phone" placeholder="0123 456 789">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" id="email" placeholder="email@example.com">
                            </div>
                            <div class="form-group">
                                <label>Địa chỉ giao hàng *</label>
                                <input type="text" id="address" placeholder="Số nhà, tên đường">
                            </div>
                            <div class="form-row three">
                                <div class="form-group">
                                    <select id="city">
                                        <option>TP. Hồ Chí Minh</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <select id="district">
                                        <option>Quận 1</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <select id="ward">
                                        <option>Phường 1</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <textarea id="notes" placeholder="Ghi chú cho đơn hàng (tuỳ chọn)"></textarea>
                            </div>
                        </div>
                        <!-- Thanh toán -->
                        <div class="card">
                            <h3>💳 Phương thức thanh toán</h3>
                            <div class="payment-methods">
                                <div class="payment active" onclick="selectPayment(this, 'COD')">💵 Tiền mặt (COD)</div>
                                <div class="payment" onclick="selectPayment(this, 'MoMo')">📱 MoMo</div>
                                <div class="payment" onclick="selectPayment(this, 'Bank')">🏦 Ngân hàng</div>
                            </div>
                            <input type="hidden" id="paymentMethod" value="COD" />
                        </div>
                    </div>
                    <!-- RIGHT -->
                    <div>
                        <div class="card summary">
                            <h3>🛒 Tóm tắt đơn hàng</h3>
                            <div id="orderItems"></div>
                            <hr>
                            <div class="item">
                                <span>Tạm tính</span>
                                <span id="checkoutSubtotal">0₫</span>
                            </div>
                            <div class="item" id="checkoutDiscountRow" style="display:none;">
                                <span>Giảm giá</span>
                                <span id="checkoutDiscount">0₫</span>
                            </div>
                            <div class="item">
                                <span>Phí vận chuyển</span>
                                <span id="checkoutShipping">0₫</span>
                            </div>
                            <hr>
                            <div class="item total">
                                <span>Tổng cộng</span>
                                <span id="checkoutTotal">0₫</span>
                            </div>
                            <button class="btn-checkout" onclick="placeOrder()">Xác nhận thanh toán</button>
                        </div>
                    </div>
                </div>


<script>
// --- JS xử lý giao diện và logic thanh toán ---
function selectPayment(el, method) {
    document.querySelectorAll('.payment').forEach(p => p.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('paymentMethod').value = method;
}

function validateCheckoutForm() {
    const fullName = document.getElementById('fullName').value;
    const phone = document.getElementById('phone').value;
    const address = document.getElementById('address').value;
    const city = document.getElementById('city').value;
    const district = document.getElementById('district').value;
    const ward = document.getElementById('ward').value;
    if (!fullName || !phone || !address || !city || !district || !ward) {
        alert('Vui lòng điền đầy đủ thông tin giao hàng!');
        return false;
    }
    return true;
}

function placeOrder() {
    if (!validateCheckoutForm()) return;
    const fullName = document.getElementById('fullName').value;
    const phone = document.getElementById('phone').value;
    const address = document.getElementById('address').value;
    const city = document.getElementById('city').value;
    const district = document.getElementById('district').value;
    const ward = document.getElementById('ward').value;
    const paymentMethod = document.getElementById('paymentMethod').value;
    const order = {
        customer: {
            fullName,
            phone,
            email: document.getElementById('email').value,
            address: `${address}, ${ward}, ${district}, ${city}`
        },
        // items: cart, // Bạn cần bổ sung logic lấy cart từ localStorage hoặc server nếu muốn
        paymentMethod,
        notes: document.getElementById('notes').value,
        orderDate: new Date().toISOString(),
        status: 'Chờ xác nhận'
    };
    // Save order to localStorage (in real app, send to API)
    let orders = JSON.parse(localStorage.getItem('orders') || '[]');
    orders.push(order);
    localStorage.setItem('orders', JSON.stringify(orders));
    // Clear cart
    localStorage.removeItem('cart');
    if (typeof updateCartCount === 'function') updateCartCount();
    // Show success message
    alert('Đặt hàng thành công! Cảm ơn bạn đã mua hàng.');
    // Redirect to home or order confirmation page
    window.location.href = '@Url.Action("Index", "Home")';
}

// Bạn có thể bổ sung các hàm loadOrderSummary, renderOrderItems... ở đây nếu cần
</script>
