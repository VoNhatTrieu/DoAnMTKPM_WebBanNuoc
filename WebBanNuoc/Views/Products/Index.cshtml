@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@{
    ViewBag.Title = "Sản Phẩm";
    string category = ViewBag.Category ?? "";
    string sort = ViewBag.Sort ?? "";

    // Tiêu đề danh mục
    string categoryTitle = "Tất Cả Sản Phẩm";
    switch (category.ToLower())
    {
        case "tra-sua": categoryTitle = "Trà Sữa"; break;
        case "tra-trai-cay": categoryTitle = "Trà Trái Cây"; break;
        case "ca-phe": categoryTitle = "Cà Phê"; break;
        case "sinh-to": categoryTitle = "Sinh Tố"; break;
        case "nuoc-ep": categoryTitle = "Nước Ép"; break;
        case "soda": categoryTitle = "Soda"; break;
        case "banh-ngot": categoryTitle = "Bánh Ngọt"; break;
    }
}<div class="products-page">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")">Trang Chủ</a></li>
            <li class="breadcrumb-item active" aria-current="page">@categoryTitle</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="page-header mb-4">
        <h1 class="display-5 fw-bold">@categoryTitle</h1>
        <p class="text-muted">Khám phá các món đồ uống tuyệt vời của chúng tôi</p>
    </div>

    <div class="row">
        <!-- Sidebar Filter -->
        <div class="col-lg-3 mb-4">
            <div class="filter-sidebar">
                <h5 class="mb-3">Danh Mục</h5>
                <div class="list-group mb-4">
                    <a href="@Url.Action("Index", "Products")"
                       class="list-group-item list-group-item-action @(string.IsNullOrEmpty(category) ? "active" : "")">
                        Tất Cả
                    </a>
                    <a href="@Url.Action("Index", "Products", new { category = "tra-sua" })"
                       class="list-group-item list-group-item-action @(category == "tra-sua" ? "active" : "")">
                        Trà Sữa
                    </a>
                    <a href="@Url.Action("Index", "Products", new { category = "tra-trai-cay" })"
                       class="list-group-item list-group-item-action @(category == "tra-trai-cay" ? "active" : "")">
                        Trà Trái Cây
                    </a>
                    <a href="@Url.Action("Index", "Products", new { category = "ca-phe" })"
                       class="list-group-item list-group-item-action @(category == "ca-phe" ? "active" : "")">
                        Cà Phê
                    </a>
                    <a href="@Url.Action("Index", "Products", new { category = "sinh-to" })"
                       class="list-group-item list-group-item-action @(category == "sinh-to" ? "active" : "")">
                        Sinh Tố
                    </a>
                    <a href="@Url.Action("Index", "Products", new { category = "nuoc-ep" })"
                       class="list-group-item list-group-item-action @(category == "nuoc-ep" ? "active" : "")">
                        Nước Ép
                    </a>
                    <a href="@Url.Action("Index", "Products", new { category = "soda" })"
                       class="list-group-item list-group-item-action @(category == "soda" ? "active" : "")">
                        Soda
                    </a>
                    <a href="@Url.Action("Index", "Products", new { category = "banh-ngot" })"
                       class="list-group-item list-group-item-action @(category == "banh-ngot" ? "active" : "")">
                        Bánh Ngọt
                    </a>
                </div>

                <h5 class="mb-3">Khoảng Giá</h5>
                <div class="list-group mb-4">
                    <a href="#" class="list-group-item list-group-item-action" onclick="filterByPrice(0, 30000); return false;">
                        Dưới 30.000đ
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" onclick="filterByPrice(30000, 50000); return false;">
                        30.000đ - 50.000đ
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" onclick="filterByPrice(50000, 70000); return false;">
                        50.000đ - 70.000đ
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" onclick="filterByPrice(70000, 999999); return false;">
                        Trên 70.000đ
                    </a>
                </div>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="col-lg-9">
            <!-- Toolbar -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <span class="text-muted">Hiển thị <span id="productCount">0</span> sản phẩm</span>
                </div>
                <div class="d-flex gap-2">
                    <select class="form-select form-select-sm" id="sortSelect" style="width: auto;">
                        <option value="">Sắp xếp</option>
                        <option value="price-asc" @(sort == "price-asc" ? "selected" : "")>Giá: Thấp đến Cao</option>
                        <option value="price-desc" @(sort == "price-desc" ? "selected" : "")>Giá: Cao đến Thấp</option>
                        <option value="name-asc" @(sort == "name-asc" ? "selected" : "")>Tên: A-Z</option>
                        <option value="name-desc" @(sort == "name-desc" ? "selected" : "")>Tên: Z-A</option>
                        <option value="popular" @(sort == "popular" ? "selected" : "")>Phổ Biến</option>
                    </select>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="row g-4" id="productsGrid">
                <!-- Products will be loaded here by JavaScript -->
            </div>

            <!-- Pagination -->
            <nav aria-label="Products pagination" class="mt-5">
                <ul class="pagination justify-content-center" id="pagination">
                    <!-- Pagination will be loaded by JavaScript -->
                </ul>
            </nav>
        </div>
    </div>
</div>

@section styles {
    <style>
        .products-page {
            padding: 2rem 0;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .filter-sidebar {
            background: #fff;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: sticky;
            top: 80px;
        }

            .filter-sidebar h5 {
                color: var(--primary-color);
                font-weight: 600;
                padding-bottom: 0.5rem;
                border-bottom: 2px solid var(--primary-color);
            }

        .list-group-item {
            border: none;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

            .list-group-item:hover {
                background: #f8f9fa;
                border-left-color: var(--primary-color);
                transform: translateX(5px);
            }

            .list-group-item.active {
                background: var(--primary-color);
                border-left-color: var(--accent-color);
                color: white;
            }

        .product-card {
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

            .product-card:hover {
                transform: translateY(-10px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            }

        .product-image {
            position: relative;
            padding-top: 100%;
            overflow: hidden;
            background: #f8f9fa;
        }

            .product-image img {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 1;
        }

        .product-info {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
            min-height: 2.6em;
        }

        .product-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .btn-add-cart {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

            .btn-add-cart:hover {
                background: var(--accent-color);
                transform: scale(1.05);
            }

        .pagination .page-link {
            color: var(--primary-color);
            border: 1px solid #ddd;
            margin: 0 5px;
            border-radius: 8px;
        }

            .pagination .page-link:hover {
                background: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
            }

        .pagination .page-item.active .page-link {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        @@media (max-width: 991px) {
            .filter-sidebar {
                position: static;
            }
        }
    </style>
}

@section scripts {
    <script>
        // Sample products database
        const allProducts = [
            // Trà Sữa
            { id: 1, name: "Trà Sữa Trân Châu Đường Đen", category: "tra-sua", price: 45000, image: "https://via.placeholder.com/300x300?text=Tra+Sua+Tran+Chau", description: "Trà sữa thơm ngon với trân châu đường đen dai mềm", popular: true },
            { id: 2, name: "Trà Sữa Ô Long", category: "tra-sua", price: 40000, image: "https://via.placeholder.com/300x300?text=Tra+Sua+Olong", description: "Vị trà ô long đặc trưng hòa quyện cùng sữa" },
            { id: 3, name: "Trà Sữa Matcha", category: "tra-sua", price: 48000, image: "https://via.placeholder.com/300x300?text=Tra+Sua+Matcha", description: "Matcha thơm béo kết hợp hoàn hảo với sữa tươi", popular: true },
            { id: 4, name: "Trà Sữa Khoai Môn", category: "tra-sua", price: 45000, image: "https://via.placeholder.com/300x300?text=Tra+Sua+Khoai+Mon", description: "Hương vị khoai môn béo ngậy độc đáo" },
            { id: 5, name: "Trà Sữa Chocolate", category: "tra-sua", price: 42000, image: "https://via.placeholder.com/300x300?text=Tra+Sua+Chocolate", description: "Sô cô la đậm đà hòa quyện cùng trà sữa" },

            // Trà Trái Cây
            { id: 6, name: "Trà Đào Cam Sả", category: "tra-trai-cay", price: 38000, image: "https://via.placeholder.com/300x300?text=Tra+Dao+Cam+Sa", description: "Vị đào ngọt, cam chua, sả thơm", popular: true },
            { id: 7, name: "Trà Vải", category: "tra-trai-cay", price: 35000, image: "https://via.placeholder.com/300x300?text=Tra+Vai", description: "Trà vải tươi mát, ngọt thanh" },
            { id: 8, name: "Trà Chanh Leo", category: "tra-trai-cay", price: 32000, image: "https://via.placeholder.com/300x300?text=Tra+Chanh+Leo", description: "Chua ngọt hài hòa của chanh leo" },
            { id: 9, name: "Trà Dâu", category: "tra-trai-cay", price: 36000, image: "https://via.placeholder.com/300x300?text=Tra+Dau", description: "Hương dâu tây tươi mát, ngọt dịu" },
            { id: 10, name: "Trà Xoài", category: "tra-trai-cay", price: 38000, image: "https://via.placeholder.com/300x300?text=Tra+Xoai", description: "Xoài chín mọng hòa quyện trà thơm" },

            // Cà Phê
            { id: 11, name: "Cà Phê Đen Đá", category: "ca-phe", price: 25000, image: "https://via.placeholder.com/300x300?text=Ca+Phe+Den", description: "Cà phê đen truyền thống đậm đà" },
            { id: 12, name: "Cà Phê Sữa", category: "ca-phe", price: 28000, image: "https://via.placeholder.com/300x300?text=Ca+Phe+Sua", description: "Cà phê sữa đá đậm vị", popular: true },
            { id: 13, name: "Bạc Xỉu", category: "ca-phe", price: 30000, image: "https://via.placeholder.com/300x300?text=Bac+Xiu", description: "Cà phê sữa nhẹ, ngọt dịu" },
            { id: 14, name: "Cappuccino", category: "ca-phe", price: 42000, image: "https://via.placeholder.com/300x300?text=Cappuccino", description: "Cappuccino Ý truyền thống" },
            { id: 15, name: "Latte", category: "ca-phe", price: 45000, image: "https://via.placeholder.com/300x300?text=Latte", description: "Latte mềm mại, bọt sữa mịn" },

            // Sinh Tố
            { id: 16, name: "Sinh Tố Bơ", category: "sinh-to", price: 38000, image: "https://via.placeholder.com/300x300?text=Sinh+To+Bo", description: "Bơ béo ngậy, thơm ngon", popular: true },
            { id: 17, name: "Sinh Tố Xoài", category: "sinh-to", price: 35000, image: "https://via.placeholder.com/300x300?text=Sinh+To+Xoai", description: "Xoài chín mọng, ngọt mát" },
            { id: 18, name: "Sinh Tố Dâu", category: "sinh-to", price: 40000, image: "https://via.placeholder.com/300x300?text=Sinh+To+Dau", description: "Dâu tươi mát lạnh, ngọt tự nhiên" },
            { id: 19, name: "Sinh Tố Sapoche", category: "sinh-to", price: 36000, image: "https://via.placeholder.com/300x300?text=Sinh+To+Sapoche", description: "Sapoche béo, ngọt đậm đà" },
            { id: 20, name: "Sinh Tố Dưa Hấu", category: "sinh-to", price: 32000, image: "https://via.placeholder.com/300x300?text=Sinh+To+Dua+Hau", description: "Dưa hấu tươi mát, giải nhiệt" },

            // Nước Ép
            { id: 21, name: "Nước Ép Cam", category: "nuoc-ep", price: 35000, image: "https://via.placeholder.com/300x300?text=Nuoc+Ep+Cam", description: "Cam tươi nguyên chất 100%" },
            { id: 22, name: "Nước Ép Ổi", category: "nuoc-ep", price: 32000, image: "https://via.placeholder.com/300x300?text=Nuoc+Ep+Oi", description: "Ổi tươi giàu vitamin C" },
            { id: 23, name: "Nước Ép Dứa", category: "nuoc-ep", price: 30000, image: "https://via.placeholder.com/300x300?text=Nuoc+Ep+Dua", description: "Dứa tươi ngọt mát, giải nhiệt" },
            { id: 24, name: "Nước Ép Cà Rốt", category: "nuoc-ep", price: 33000, image: "https://via.placeholder.com/300x300?text=Nuoc+Ep+Ca+Rot", description: "Cà rốt tươi, bổ dưỡng" },

            // Soda
            { id: 25, name: "Soda Việt Quất", category: "soda", price: 35000, image: "https://via.placeholder.com/300x300?text=Soda+Viet+Quat", description: "Soda việt quất tươi mát" },
            { id: 26, name: "Soda Chanh", category: "soda", price: 30000, image: "https://via.placeholder.com/300x300?text=Soda+Chanh", description: "Soda chanh tươi sảng khoái", popular: true },
            { id: 27, name: "Soda Dâu", category: "soda", price: 35000, image: "https://via.placeholder.com/300x300?text=Soda+Dau", description: "Soda dâu ngọt thanh, mát lạnh" },

            // Bánh Ngọt
            { id: 28, name: "Bánh Croissant", category: "banh-ngot", price: 28000, image: "https://via.placeholder.com/300x300?text=Croissant", description: "Bánh croissant bơ thơm giòn" },
            { id: 29, name: "Bánh Tiramisu", category: "banh-ngot", price: 45000, image: "https://via.placeholder.com/300x300?text=Tiramisu", description: "Tiramisu Ý truyền thống", popular: true },
            { id: 30, name: "Bánh Red Velvet", category: "banh-ngot", price: 42000, image: "https://via.placeholder.com/300x300?text=Red+Velvet", description: "Bánh red velvet mềm mịn" }
        ];

        let currentPage = 1;
        const productsPerPage = 12;
        let filteredProducts = [...allProducts];
        let currentCategory = '@category';
        let currentSort = '@sort';
        let priceFilter = { min: 0, max: 999999 };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            filterProducts();

            // Sort change event
            document.getElementById('sortSelect').addEventListener('change', function() {
                currentSort = this.value;
                sortProducts();
                displayProducts();
            });
        });

      

        function filterByPrice(min, max) {
            priceFilter = { min, max };
            currentPage = 1;
            filterProducts();
        }

        function sortProducts() {
            switch(currentSort) {
                case 'price-asc':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'name-asc':
                    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    filteredProducts.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'popular':
                    filteredProducts.sort((a, b) => (b.popular ? 1 : 0) - (a.popular ? 1 : 0));
                    break;
            }
        }

        function displayProducts() {
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const productsToShow = filteredProducts.slice(startIndex, endIndex);

            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            if (productsToShow.length === 0) {
                grid.innerHTML = '<div class="col-12 text-center py-5"><p class="text-muted">Không tìm thấy sản phẩm nào</p></div>';
                document.getElementById('productCount').textContent = '0';
                return;
            }

            productsToShow.forEach(product => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4';
                col.innerHTML = `
                    <div class="product-card">
                        <div class="product-image">
                            ${product.popular ? '<span class="product-badge">Phổ Biến</span>' : ''}
                            <img src="${product.image}" alt="${product.name}">
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                            <div class="product-footer">
                                <span class="product-price">${product.price.toLocaleString('vi-VN')}đ</span>
                                <a href="@Url.Action("ProductDetail", "Products")?id=${product.id}" class="btn btn-add-cart">
                                    <i class="fas fa-shopping-cart me-1"></i> Thêm
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(col);
            });

            document.getElementById('productCount').textContent = filteredProducts.length;
            displayPagination();
        }

        function displayPagination() {
            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (totalPages <= 1) return;

            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">Trước</a>`;
            pagination.appendChild(prevLi);

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    const li = document.createElement('li');
                    li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>`;
                    pagination.appendChild(li);
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    const li = document.createElement('li');
                    li.className = 'page-item disabled';
                    li.innerHTML = '<span class="page-link">...</span>';
                    pagination.appendChild(li);
                }
            }

            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">Sau</a>`;
            pagination.appendChild(nextLi);
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
            if (page < 1 || page > totalPages) return;

            currentPage = page;
            displayProducts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        let keyword = '@ViewBag.Keyword';


        function filterProducts() {
            filteredProducts = [...allProducts];

            
            if (currentCategory && currentCategory !== '') {
                filteredProducts = filteredProducts.filter(
                    p => p.category === currentCategory
                );
            }

           
            if (keyword && keyword.trim() !== "") {
                filteredProducts = filteredProducts.filter(p =>
                    p.name.toLowerCase().includes(keyword.toLowerCase())
                );
            }

          
            filteredProducts = filteredProducts.filter(p =>
                p.price >= priceFilter.min && p.price <= priceFilter.max
            );

            sortProducts();

           
            displayProducts();
        }


    </script>
}
